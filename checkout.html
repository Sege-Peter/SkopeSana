<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | SkopeSana</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header (same as index.html) -->
    
    <main class="checkout-page container">
        <div class="breadcrumbs">
            <a href="index.html">Home</a> > 
            <a href="cart.html">Cart</a> > 
            <span>Checkout</span>
        </div>
        
        <h1>Checkout</h1>
        
        <div class="checkout-container">
            <div class="checkout-steps">
                <div class="step active" data-step="1">
                    <span>1</span>
                    <span>Shipping</span>
                </div>
                <div class="step" data-step="2">
                    <span>2</span>
                    <span>Payment</span>
                </div>
                <div class="step" data-step="3">
                    <span>3</span>
                    <span>Confirmation</span>
                </div>
            </div>
            
            <form id="checkout-form" class="checkout-form">
                <!-- Step 1: Shipping Information -->
                <div class="checkout-step" id="step-1">
                    <h2>Shipping Information</h2>
                    
                    <div class="form-group">
                        <label for="full-name">Full Name</label>
                        <input type="text" id="full-name" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" id="address" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" required>
                        </div>
                        <div class="form-group">
                            <label for="county">County</label>
                            <select id="county" required>
                                <option value="">Select County</option>
                                <option value="nairobi">Nairobi</option>
                                <option value="kiambu">Kiambu</option>
                                <option value="nakuru">Nakuru</option>
                                <option value="mombasa">Mombasa</option>
                                <option value="kisumu">Kisumu</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Delivery Notes (Optional)</label>
                        <textarea id="notes" rows="3"></textarea>
                    </div>
                    
                    <div class="step-actions">
                        <a href="cart.html"class="btn" id="cancel-checkout">Cancel</a>
                        <button type="button" class="btn" id="next-to-payment">Continue to Payment</button>
                    </div>
                </div>
                
                <!-- Step 2: Payment Information -->
                <div class="checkout-step" id="step-2" style="display: none;">
                    <h2>Payment Method</h2>
                    
                    <div class="payment-methods">
                        <div class="payment-method active" data-method="mpesa">
                            <div class="method-radio">
                                <input type="radio" name="payment-method" id="mpesa" checked>
                            </div>
                            <label for="mpesa">
                                <i class="fab fa-mpesa"></i>
                                <span>M-Pesa</span>
                            </label>
                        </div>
                        
                        <div class="payment-method" data-method="cash">
                            <div class="method-radio">
                                <input type="radio" name="payment-method" id="cash">
                            </div>
                            <label for="cash">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Cash on Delivery</span>
                            </label>
                        </div>
                        
                        <div class="payment-method" data-method="card">
                            <div class="method-radio">
                                <input type="radio" name="payment-method" id="card">
                            </div>
                            <label for="card">
                                <i class="far fa-credit-card"></i>
                                <span>Credit/Debit Card</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- M-Pesa Payment Details -->
                    <div class="payment-details" id="mpesa-details">
                        <p>Complete payment via M-Pesa:</p>
                        <ol>
                            <li>Go to M-Pesa menu on your phone</li>
                            <li>Select "Lipa na M-Pesa"</li>
                            <li>Enter Paybill: <strong>123456</strong></li>
                            <li>Account: <strong>Your Order Number</strong></li>
                            <li>Enter Amount: <strong id="mpesa-amount">KSh 0</strong></li>
                            <li>Enter your M-Pesa PIN</li>
                        </ol>
                        <div class="form-group">
                            <label for="mpesa-code">M-Pesa Transaction Code</label>
                            <input type="text" id="mpesa-code" placeholder="e.g. RL1234ABCD">
                        </div>
                    </div>
                    
                    <!-- Card Payment Details -->
                    <div class="payment-details" id="card-details" style="display: none;">
                        <div class="form-group">
                            <label for="card-number">Card Number</label>
                            <input type="text" id="card-number" placeholder="1234 5678 9012 3456">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="card-expiry">Expiry Date</label>
                                <input type="text" id="card-expiry" placeholder="MM/YY">
                            </div>
                            <div class="form-group">
                                <label for="card-cvv">CVV</label>
                                <input type="text" id="card-cvv" placeholder="123">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="card-name">Name on Card</label>
                            <input type="text" id="card-name">
                        </div>
                    </div>
                    
                    <!-- Cash on Delivery Message -->
                    <div class="payment-details" id="cash-details" style="display: none;">
                        <p>Pay with cash when your order is delivered. An additional KSh 200 service charge applies.</p>
                    </div>
                    
                    <div class="order-summary">
                        <h3>Order Summary</h3>
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="checkout-subtotal">KSh 0</span>
                        </div>
                        <div class="summary-row">
                            <span>Delivery</span>
                            <span id="checkout-delivery">KSh 0</span>
                        </div>
                        <div class="summary-row">
                            <span>Service Fee</span>
                            <span id="checkout-fee">KSh 0</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span id="checkout-total">KSh 0</span>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button type="button" class="btn btn-outline" id="back-to-shipping">Back</button>
                        <button type="button" class="btn" id="place-order">Place Order</button>
                    </div>
                </div>
                
                <!-- Step 3: Order Confirmation -->
                <div class="checkout-step" id="step-3" style="display: none;">
                    <div class="order-confirmation">
                        <div class="confirmation-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h2>Order Confirmed!</h2>
                        <p>Thank you for your purchase. Your order has been received.</p>
                        <div class="order-details">
                            <div class="detail-row">
                                <span>Order Number:</span>
                                <span id="order-number">SKOPE-12345</span>
                            </div>
                            <div class="detail-row">
                                <span>Date:</span>
                                <span id="order-date">May 15, 2023</span>
                            </div>
                            <div class="detail-row">
                                <span>Total:</span>
                                <span id="order-total">KSh 15,299</span>
                            </div>
                            <div class="detail-row">
                                <span>Payment Method:</span>
                                <span id="order-payment">M-Pesa</span>
                            </div>
                        </div>
                        <p>We've sent a confirmation email to <strong id="customer-email">user@example.com</strong></p>
                        <div class="confirmation-actions">
                            <a href="index.html" class="btn">Continue Shopping</a>
                            <a href="#" class="btn btn-outline">Track Order</a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </main>
    
    <!-- Footer (same as index.html) -->
    <style>
        /* Base Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f9f9f9;
    color: #333;
    line-height: 1.6;
}

a {
    color: #007bff;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

.container {
    max-width: 1100px;
    margin: auto;
    padding: 20px;
}

/* Breadcrumbs */
.breadcrumbs {
    margin-bottom: 20px;
    font-size: 0.95rem;
    color: #666;
}

/* Header & Title */
h1, h2, h3 {
    margin-bottom: 15px;
    color: #222;
}

.checkout-page .checkout-container {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
}

/* Steps Progress */
.checkout-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
}

.step {
    flex: 1;
    text-align: center;
    padding: 10px;
    position: relative;
    color: #aaa;
}

.step.active {
    color: #007bff;
    font-weight: bold;
}

.step span:first-child {
    display: inline-block;
    background: #e0e0e0;
    color: #333;
    border-radius: 50%;
    padding: 8px 14px;
    margin-bottom: 5px;
}

.step.active span:first-child {
    background: #007bff;
    color: #fff;
}

/* Form Styles */
.checkout-form {
    width: 100%;
}

.checkout-step {
    display: block;
}

.form-group {
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 6px;
    font-weight: 500;
}

.form-group input,
.form-group select,
.form-group textarea {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
}

.form-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.form-row .form-group {
    flex: 1;
}

/* Buttons */
.btn {
    display: inline-block;
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s;
}

.btn:hover {
    background-color: #0056b3;
}

.btn-outline {
    background-color: transparent;
    color: #007bff;
    border: 2px solid #007bff;
}

.btn-outline:hover {
    background-color: #007bff;
    color: white;
}

/* Payment Method */
.payment-methods {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.payment-method {
    display: flex;
    align-items: center;
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.payment-method.active {
    border-color: #007bff;
    background-color: #f0f8ff;
}

.payment-method i {
    font-size: 1.5rem;
    margin-right: 10px;
}

.payment-details {
    margin-top: 20px;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 10px;
}

/* Order Summary */
.order-summary {
    margin-top: 30px;
    border-top: 1px solid #ddd;
    padding-top: 20px;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
}

.summary-row.total {
    font-weight: bold;
    border-top: 1px solid #ccc;
    margin-top: 10px;
    padding-top: 10px;
}

/* Order Confirmation */
.order-confirmation {
    text-align: center;
}

.confirmation-icon {
    font-size: 4rem;
    color: green;
    margin-bottom: 15px;
}

.order-details {
    text-align: left;
    margin: 20px auto;
    max-width: 400px;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
}

/* Responsive */
@media screen and (max-width: 768px) {
    .form-row {
        flex-direction: column;
    }

    .checkout-steps {
        flex-direction: column;
    }

    .step {
        margin-bottom: 10px;
    }

    .payment-methods {
        flex-direction: column;
    }
}

    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const checkoutForm = document.getElementById('checkout-form');
    const steps = document.querySelectorAll('.checkout-step');
    const stepIndicators = document.querySelectorAll('.checkout-steps .step');
    const paymentMethods = document.querySelectorAll('.payment-method');
    const paymentDetails = document.querySelectorAll('.payment-details');
    
    // Order data
    let currentStep = 1;
    let orderData = {
        shipping: {},
        payment: {},
        cart: JSON.parse(localStorage.getItem('skopesana_cart')) || [],
        totals: {
            subtotal: 0,
            delivery: 0,
            serviceFee: 0,
            total: 0
        }
    };

    // Initialize checkout
    initCheckout();

    function initCheckout() {
        // Load cart and calculate totals
        calculateOrderTotals();
        
        // Set up event listeners
        setupEventListeners();
        
        // Show current step
        updateStepDisplay();
    }

    function calculateOrderTotals() {
        // Calculate subtotal from cart
        orderData.totals.subtotal = orderData.cart.reduce((total, item) => {
            const product = getProductById(item.id);
            return total + (product ? product.price * item.quantity : 0);
        }, 0);
        
        // Calculate delivery (free for orders over 10000)
        orderData.totals.delivery = orderData.totals.subtotal > 10000 ? 0 : 300;
        
        // Calculate service fee (200 for cash on delivery)
        orderData.totals.serviceFee = orderData.payment.method === 'cash' ? 200 : 0;
        
        // Calculate total
        orderData.totals.total = orderData.totals.subtotal + 
                               orderData.totals.delivery + 
                               orderData.totals.serviceFee;
        
        // Update UI
        updateOrderSummary();
    }

    function getProductById(id) {
        // In a real implementation, this would fetch from your products data
        // For demo, we'll use a mock function
        const products = [
            { id: 1, name: "Samsung Galaxy A20", price: 12999 },
            { id: 2, name: "Oraimo Power Bank", price: 3499 }
            // ... other products
        ];
        return products.find(p => p.id == id);
    }

    function setupEventListeners() {
        // Next button (step 1 -> step 2)
        document.getElementById('next-to-payment').addEventListener('click', function(e) {
            e.preventDefault();
            if (validateShippingStep()) {
                saveShippingData();
                currentStep = 2;
                updateStepDisplay();
            }
        });
        
        // Back button (step 2 -> step 1)
        document.getElementById('back-to-shipping').addEventListener('click', function(e) {
            e.preventDefault();
            currentStep = 1;
            updateStepDisplay();
        });
        
        // Payment method selection
        paymentMethods.forEach(method => {
            method.addEventListener('click', function() {
                const methodName = this.getAttribute('data-method');
                selectPaymentMethod(methodName);
            });
        });
        
        // Place order button
        document.getElementById('place-order').addEventListener('click', function(e) {
            e.preventDefault();
            if (validatePaymentStep()) {
                savePaymentData();
                processOrder();
            }
        });
        
        // Cancel checkout
        document.getElementById('cancel-checkout').addEventListener('click', function() {
            if (confirm('Are you sure you want to cancel your order?')) {
                window.location.href = 'cart.html';
            }
        });
    }

    function validateShippingStep() {
        const requiredFields = ['full-name', 'email', 'phone', 'address', 'city', 'county'];
        let isValid = true;
        
        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (!field.value.trim()) {
                field.classList.add('error');
                isValid = false;
            } else {
                field.classList.remove('error');
            }
            
            // Special validation for email
            if (fieldId === 'email' && field.value.trim()) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(field.value)) {
                    field.classList.add('error');
                    isValid = false;
                }
            }
        });
        
        if (!isValid) {
            showNotification('Please fill all required fields correctly');
        }
        
        return isValid;
    }

    function saveShippingData() {
        orderData.shipping = {
            name: document.getElementById('full-name').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            address: document.getElementById('address').value,
            city: document.getElementById('city').value,
            county: document.getElementById('county').value,
            notes: document.getElementById('notes').value
        };
    }

    function selectPaymentMethod(method) {
        // Update selected payment method
        orderData.payment.method = method;
        
        // Update UI
        paymentMethods.forEach(m => m.classList.remove('active'));
        document.querySelector(`.payment-method[data-method="${method}"]`).classList.add('active');
        
        paymentDetails.forEach(d => d.style.display = 'none');
        document.getElementById(`${method}-details`).style.display = 'block';
        
        // Recalculate totals (for cash on delivery fee)
        calculateOrderTotals();
    }

    function validatePaymentStep() {
        let isValid = true;
        const method = orderData.payment.method;
        
        if (method === 'mpesa') {
            const mpesaCode = document.getElementById('mpesa-code').value.trim();
            if (!mpesaCode) {
                document.getElementById('mpesa-code').classList.add('error');
                isValid = false;
            } else {
                orderData.payment.mpesaCode = mpesaCode;
            }
        } 
        else if (method === 'card') {
            const cardFields = ['card-number', 'card-expiry', 'card-cvv', 'card-name'];
            cardFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                    orderData.payment[fieldId] = field.value;
                }
            });
        }
        
        if (!isValid) {
            showNotification('Please complete all required payment details');
        }
        
        return isValid;
    }

    function savePaymentData() {
        // For M-Pesa, we already saved the code in validatePaymentStep
        if (orderData.payment.method === 'cash') {
            orderData.payment.cashOnDelivery = true;
        }
    }

    function processOrder() {
        // Generate order number
        const orderNumber = 'SKOPE-' + Math.floor(10000 + Math.random() * 90000);
        orderData.orderNumber = orderNumber;
        orderData.date = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        // In a real implementation, you would send this data to your backend
        console.log('Order processed:', orderData);
        
        // Save order to localStorage (for demo purposes)
        localStorage.setItem('skopesana_lastOrder', JSON.stringify(orderData));
        
        // Clear cart
        localStorage.removeItem('skopesana_cart');
        
        // Update UI for confirmation step
        document.getElementById('order-number').textContent = orderNumber;
        document.getElementById('order-date').textContent = orderData.date;
        document.getElementById('order-total').textContent = `KSh ${orderData.totals.total.toLocaleString()}`;
        document.getElementById('order-payment').textContent = 
            orderData.payment.method === 'mpesa' ? 'M-Pesa' : 
            orderData.payment.method === 'cash' ? 'Cash on Delivery' : 'Credit/Debit Card';
        document.getElementById('customer-email').textContent = orderData.shipping.email;
        
        // Go to confirmation step
        currentStep = 3;
        updateStepDisplay();
    }

    function updateStepDisplay() {
        // Update step indicators
        stepIndicators.forEach(step => {
            const stepNum = parseInt(step.getAttribute('data-step'));
            step.classList.toggle('active', stepNum === currentStep);
            step.classList.toggle('completed', stepNum < currentStep);
        });
        
        // Show current step content
        steps.forEach(step => {
            const stepNum = parseInt(step.id.split('-')[1]);
            step.style.display = stepNum === currentStep ? 'block' : 'none';
        });
    }

    function updateOrderSummary() {
        document.getElementById('checkout-subtotal').textContent = 
            `KSh ${orderData.totals.subtotal.toLocaleString()}`;
        document.getElementById('checkout-delivery').textContent = 
            orderData.totals.delivery === 0 ? 'FREE' : `KSh ${orderData.totals.delivery.toLocaleString()}`;
        document.getElementById('checkout-fee').textContent = 
            orderData.totals.serviceFee === 0 ? 'FREE' : `KSh ${orderData.totals.serviceFee.toLocaleString()}`;
        document.getElementById('checkout-total').textContent = 
            `KSh ${orderData.totals.total.toLocaleString()}`;
        
        // Update M-Pesa amount display
        if (document.getElementById('mpesa-amount')) {
            document.getElementById('mpesa-amount').textContent = 
                `KSh ${orderData.totals.total.toLocaleString()}`;
        }
    }

    function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);
        
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    // Initialize payment method
    selectPaymentMethod('mpesa');
});
    </script>
</body>
</html>
